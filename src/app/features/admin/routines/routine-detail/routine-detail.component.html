<div class="routine-detail-container">

    <mat-card class="routine-info-card">

        <h2>{{ routine?.name }}</h2>

        <p>
            <strong>Duraci√≥n:</strong>
            {{ routine?.durationValue }} {{ routine?.durationType }}
        </p>

        <p>{{ routine?.description }}</p>

    </mat-card>

    <mat-card class="day-builder-card">

        <!-- HEADER -->
        <div class="day-builder-header">
            <h3>üìÖ Construir D√≠a de Entrenamiento</h3>
            <span class="day-number-badge">
                D√≠a {{ newDay.dayNumber }}
            </span>
        </div>

        <!-- DATOS DEL D√çA -->
        <div class="day-info-section">

            <mat-form-field appearance="outline">
                <mat-label>T√≠tulo del d√≠a</mat-label>
                <input matInput [(ngModel)]="newDay.title">
            </mat-form-field>

        </div>

        <hr>

        <!-- AGREGAR EJERCICIOS -->
        <div class="exercise-add-section">

            <h4>Agregar Ejercicios</h4>

            <!-- üîΩ Filtro -->
            <mat-form-field appearance="outline">
                <mat-label>Grupo muscular</mat-label>

                <mat-select [(ngModel)]="selectedMuscleGroup" (selectionChange)="filterExercisesByGroup()">

                    <mat-option *ngFor="let group of muscleGroups" [value]="group">
                        {{ group }}
                    </mat-option>

                </mat-select>
            </mat-form-field>

            <!-- üñº Grid visual -->
            <div class="exercise-grid">

                <div *ngFor="let ex of filteredExercises" class="exercise-card" (click)="addVisualExercise(ex)">

                    <img [src]="ex.imageUrl" alt="exercise">

                    <p>{{ ex.name }}</p>

                </div>

            </div>

        </div>

        <!-- LISTA VISUAL -->
        <div *ngIf="newDay.exercises.length > 0" class="exercise-list">

            <h4 class="section-title">Ejercicios agregados</h4>

            <div class="exercise-card" *ngFor="let ex of newDay.exercises; let i = index">

                <!-- HEADER -->
                <div class="exercise-header">

                    <div class="exercise-name">
                        {{ getExerciseName(ex.exerciseId) }}
                    </div>

                    <button mat-icon-button color="warn" (click)="removeExerciseFromDay(i)">
                        <mat-icon>delete</mat-icon>
                    </button>

                </div>

                <!-- CONFIG -->
                <div class="exercise-config">

                    <mat-form-field appearance="outline" class="small-field">
                        <mat-label>Sets</mat-label>
                        <input matInput type="number" [(ngModel)]="ex.sets">
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="small-field">
                        <mat-label>Reps</mat-label>
                        <input matInput [(ngModel)]="ex.reps">
                    </mat-form-field>

                </div>

            </div>

        </div>

        <!-- FOOTER -->
        <div class="day-builder-footer">

            <button mat-raised-button color="primary" (click)="addDay()"
                [disabled]="!newDay.title || newDay.exercises.length === 0">

                {{ editingDayId ? '‚úèÔ∏è Actualizar D√≠a' : 'üíæ Guardar D√≠a' }}

            </button>

        </div>

    </mat-card>

    <div class="days-list">

        <div class="day-card" *ngFor="let day of routineDays; let dIndex = index">

            <!-- HEADER -->
            <div class="day-header">

                <div class="day-badge">
                    D√≠a {{ day.dayNumber }}
                </div>

                <div class="day-title">
                    {{ day.title }}
                </div>

                <div class="day-actions">
                    <button mat-icon-button color="primary" (click)="editDay(day)">
                        <mat-icon>edit</mat-icon>
                    </button>

                    <button mat-icon-button color="warn" (click)="deleteDay(day.id)">
                        <mat-icon>delete</mat-icon>
                    </button>
                </div>

            </div>

            <!-- EJERCICIOS -->
            <div class="day-exercises">

                <div class="day-exercise-item" *ngFor="let ex of day.exercises">

                    <!-- MINI IMAGEN -->
                    <img class="exercise-thumb" [src]="getExerciseImage(ex.exerciseId)" alt="exercise">

                    <!-- INFO -->
                    <div class="exercise-info">

                        <div class="exercise-name">
                            {{ getExerciseName(ex.exerciseId) }}
                        </div>

                        <div class="exercise-muscle">
                            üí™ {{ getExerciseMuscle(ex.exerciseId) }}
                        </div>

                    </div>

                    <!-- META -->
                    <div class="exercise-meta">

                        <span class="meta-badge">
                            {{ ex.sets }} sets
                        </span>

                        <span class="meta-badge">
                            {{ ex.reps }} reps
                        </span>

                    </div>

                </div>

            </div>

        </div>

    </div>

</div>